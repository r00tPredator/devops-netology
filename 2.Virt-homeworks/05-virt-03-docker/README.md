
# Домашнее задание к занятию "5.3. Введение. Экосистема. Архитектура. Жизненный цикл Docker контейнера"

## Как сдавать задания

Обязательными к выполнению являются задачи без указания звездочки. Их выполнение необходимо для получения зачета и диплома о профессиональной переподготовке.

Задачи со звездочкой (*) являются дополнительными задачами и/или задачами повышенной сложности. Они не являются обязательными к выполнению, но помогут вам глубже понять тему.

Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

## Задача 1

Сценарий выполения задачи:

- создайте свой репозиторий на https://hub.docker.com;
- выберете любой образ, который содержит веб-сервер Nginx;
- создайте свой fork образа;
- реализуйте функциональность:
запуск веб-сервера в фоне с индекс-страницей, содержащей HTML-код ниже:
```
<html>
<head>
Hey, Netology
</head>
<meta charset="utf-8">
<body>
<h1>I’m DevOps Engineer!</h1>
</body>
</html>
```
Опубликуйте созданный форк в своем репозитории и предоставьте ответ в виде ссылки на https://hub.docker.com/username_repo.

Ответ:
docker pull nginx
```
#создаем свой обораз из Dockerfile
sudo docker build -t r00tpredator/nginx:1.18.1 .
Sending build context to Docker daemon  4.096kB
Step 1/2 : FROM nginx
 ---> 605c77e624dd
Step 2/2 : COPY index.html /usr/share/nginx/html/index.html
 ---> c3adeb44efd6
Successfully built eb172dbebdb7
Successfully tagged r00tpredator/nginx:1.18.2

#Проверяем создался ли образ
sudo docker images
REPOSITORY                 TAG               IMAGE ID       CREATED             SIZE
r00tpredator/nginx         1.18.2            eb172dbebdb7   26 seconds ago      141MB

#Запускаем контейнер из образа. Присваеваем ему имя nginx_netology2
sudo docker run --name nginx_netology3 -d c3adeb44efd6

sudo docker exec -it nginx_netology3 bash

docker login
docker push r00tpredator/nginx:1.18 

#проверяем. Где nginx имя образа
docker run -it -p 8080:80 nginx
```
https://hub.docker.com/repository/docker/r00tpredator/nginx




root@1868075efdfb:/# cat var/www/html/index.nginx-debian.html
<html> 
<head>
Hey, Netology 
</head> 
<body> 
<h1>I'm DevOps Engineer!</h1>
</body>


## Задача 2

Посмотрите на сценарий ниже и ответьте на вопрос:
"Подходит ли в этом сценарии использование Docker контейнеров или лучше подойдет виртуальная машина, физическая машина? Может быть возможны разные варианты?"

Детально опишите и обоснуйте свой выбор.

--

Сценарий:

- Высоконагруженное монолитное java веб-приложение;
- Nodejs веб-приложение;
- Мобильное приложение c версиями для Android и iOS;
- Шина данных на базе Apache Kafka;
- Elasticsearch кластер для реализации логирования продуктивного веб-приложения - три ноды elasticsearch, два logstash и две ноды kibana;
- Мониторинг-стек на базе Prometheus и Grafana;
- MongoDB, как основное хранилище данных для java-приложения;
- Gitlab сервер для реализации CI/CD процессов и приватный (закрытый) Docker Registry.


Ответ:

Высоконагруженное монолитное java веб-приложение;
 - физический сервер, т.к. монолитное, следовательно в микросерверах не реализуем без изменения кода, и так как высоконагруженное -  то необходим физический доступ к ресурсами, без использования гипервизора виртуалки.

Go-микросервис для генерации отчетов;
 - контейниризация Docker, класический вариант использования контейнеров.
 
Nodejs веб-приложение;
 - это веб приложение, для таких приложений достаточно докера.
   В рамках микропроцессрной архитектуры может быть хорошим решением. 
 
Мобильное приложение c версиями для Android и iOS;
 - VM - приложение в докере не имеет GUI, что плохо скажется на работе с мибильными приложениями. 

База данных postgresql используемая, как кэш;
  - в идеале для БД использовать Виртуалку, если доступ к кешу нужен для разных систем, пользователей, использование БД на докере не рекомендуется. Вариант с Контейнером(докер) можно рассмотреть только если данные нужны только в рамках сессии самого приложения работающего на этом же контейнере.

Шина данных на базе Apache Kafka;
 - Для продашина и критичности данных лучше Вируалка, для теста достаточно Контейнерной реализации, если потеря данных при потере контенйера не является критичной то можно и в контейнере. 

Очередь для Logstash на базе Redis;
 - физическая машина, так как требуется высокая производительность, т.к. в описании системы в задачах именно производительность заявлена. В теории можно и на Аппаратной виртуализации реализовать, зависит от нагрузки, задач и имеющейся инфраструктуры.
  
Elastic stack для реализации логирования продуктивного веб-приложения - три ноды elasticsearch, два logstash и две ноды kibana;
 - сам Elasticsearvh лучше на виртуалку, отказоустойчивость решается на уровне кластера, kibana и logstash можно вынести в докер контейнер, или так же на виртуалках.
Использование в Докерем может дать "+" для использования в тестовом периоде с максимальным функционалом, в докере можно перезаливать машину каждый месяц и получать опять полную функциональность.

Мониторинг-стек на базе prometheus и grafana;
 - сами системы не хранят как таковых данных, можно развернуть на Докере,
   минусов не вижу, плюс скорость развертывания, возможность масштабирования для различных задач: например у графаны есть ограничение на число обрабатываемых метрик и может понадобиться разделения под разные задачи (контуры)

Mongodb, как основное хранилище данных для java-приложения;
 - можно использовать Виртуальную машину, т.к. хранилище и  не сказано что высоконагруженное. В Контейнере хранить БД с данными не подходит для физического сервера может быть через чур расточительно.

Jenkins-сервер.
 - так же классический кейс для контейнерной реализации Докер, данных сам не хранит.
 
## Задача 3

- Запустите первый контейнер из образа ***centos*** c любым тэгом в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера;
- Запустите второй контейнер из образа ***debian*** в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера;
- Подключитесь к первому контейнеру с помощью ```docker exec``` и создайте текстовый файл любого содержания в ```/data```;
- Добавьте еще один файл в папку ```/data``` на хостовой машине;
- Подключитесь во второй контейнер и отобразите листинг и содержание файлов в ```/data``` контейнера.


Ответ:
```
docker pull centos8

sudo docker run -v /local-data:/data-in-container --name CentOS -d centos:8
sudo docker start centos
sudo docker exec -it centos bash

bash-5.1# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

bash-5.1# mkdir data
bash-5.1# ls
bin    data   dev    etc    home   lib    media  mnt    opt    proc   root   run    sbin   srv    sys    tmp    usr    var


bash-5.1# touch data/newfile
bash-5.1# touch data/newfile2
bash-5.1# ls data
newfile   newfile2
```

```
sudo docker pull debian:11.2

sudo docker run -v /local-data:/data-in-container --name debian -d debian:11.2

sudo docker start debian
sudo docker exec -it debian bash
# mkdir data

```


## Задача 4 (*)

Воспроизвести практическую часть лекции самостоятельно.

Соберите Docker образ с Ansible, загрузите на Docker Hub и пришлите ссылку вместе с остальными ответами к задачам.


---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
